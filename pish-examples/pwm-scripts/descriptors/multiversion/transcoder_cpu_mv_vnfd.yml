---
descriptor_version: vnfd-schema-01
description: Trasncoder VNF with multiple versions
name: transcoder-cpu-image-1-mv
vendor: cn-upb
version: '1.0'
author: Ashwin Prasad
virtual_deployment_units:
- id: transcoder-image-1
  description: transcoder-image-1
  vm_image: "transcoder-image-1"
  vm_image_format: qcow2
  resource_requirements:
    cpu:
      vcpus: 8
    memory:
      size: 16
      size_unit: GB
    storage:
      size: 10
      size_unit: GB
  connection_points:
  - id: eth0
    interface: ipv4
    type: external

virtual_deployment_units_acc:
- id: "transcoder-image-1"
  name: "transcoder-image-1"
  service_image: "pgscramble/transcoder-cn:0.9"
  service_type: "LoadBalancer"
  service_ports:
  - name: "http"
    protocol: "TCP"
    port: 80
    target_port: 80
  environment:
    - name: runtime
      value: nvidia
  resource_requirements:
    memory:
      size: 4096
      size_unit: "Mi"


virtual_deployment_units_con:
- id: "transcoder-image-1"
  name: "transcoder-image-1"
  service_image: "pgscramble/transcoder-cpu-cn:0.9"
  service_type: "LoadBalancer"
  service_ports:
  - name: "http"
    protocol: "TCP"
    port: 80
    target_port: 80
  resource_requirements:
    memory:
      size: 4096
      size_unit: "Mi"


monitoring_config:
  fetch_frequency: 30
  average_range: 30 

monitoring_parameters:
  - cpu
  - net

# - cpu
# - net
# - packets
# - mem
# - mem_usage
# - mem_usage_limit
# - mem_activity  
# - throttle_serviced_ops
# - throttle_io
# - pgfaults
# - writeback

monitoring_rules:
  - name: "acc:rule:net"
    description: "Trigger if NET Upload is above 1500 kbps in last 30s"
    duration: 30
    version: "VM"
    switch: "ACC"
    condition: "net > 1500"
    condition_extra: "upload"
  - name: "acc:rule:net"
    description: "Trigger if NET Upload is above 1500 kbps in last 30s"
    duration: 30
    version: "ACC"
    switch: "VM"
    condition: "net > 2000"
    condition_extra: "upload"


# port forwarding 8080:3000 (port:target-port) as youâ€™d do with docker run -p 8080:3000 my-app (external:internal)        

# Image name on openstack should be "cn-upb_transcoder-image-1-mv_1.0_transcoder-image-1"